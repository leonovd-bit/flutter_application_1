<!DOCTYPE html>
<html>
<head>
  <base href="$FLUTTER_BASE_HREF">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="FreshPunk Kitchen Pro - Advanced restaurant management dashboard with comprehensive order tracking and analytics.">
  
  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="FreshPunk Kitchen Pro">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>FreshPunk Kitchen Pro Dashboard</title>
  <link rel="manifest" href="manifest.json">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      /* FreshPunk Brand Colors - Exact match from main app */
      --primary-green: #4CAF50;
      --primary-dark: #388E3C;
      --primary-light: #81C784;
      --background: #FFFFFF;
      --surface: #FFFFFF;
      --surface-elevated: #F8F9FA;
      --surface-dark: #2D2D2D;
      
      /* Text Colors - Exact match */
      --text-primary: #212121;
      --text-secondary: #757575;
      --text-light: #BDBDBD;
      --text-on-dark: #FFFFFF;
      
      /* UI Colors - Exact match */
      --accent: #4CAF50;
      --accent-light: #81C784;
      --success: #4CAF50;
      --warning: #FF9800;
      --error: #F44336;
      --info: #2196F3;
      --purple: #9C27B0;
      
      /* Border & Divider Colors */
      --border: #E0E0E0;
      --border-light: #F5F5F5;
      --hover: #E8F5E8;
      
      /* FreshPunk Branding Colors from logo */
      --fresh-green: #22aa22;
      --punk-orange: #ff4444;
      --utensil-gray: #4a4a4a;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: var(--background);
      color: var(--text-primary);
      line-height: 1.6;
      font-weight: 500;
    }

    /* Typography - Exact match from main app */
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      margin: 0;
      line-height: 1.2;
    }

    h1 {
      font-size: 32px;
      font-weight: 900;
      letter-spacing: -0.5px;
    }

    h2 {
      font-size: 28px;
      font-weight: 800;
      letter-spacing: -0.3px;
    }

    h3 {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: -0.2px;
    }

    h4 {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: -0.1px;
    }

    h5 {
      font-size: 20px;
      font-weight: 600;
    }

    h6 {
      font-size: 18px;
      font-weight: 600;
    }

    p, span, div {
      font-family: 'Inter', sans-serif;
      font-weight: 500;
    }

    /* Loading Screen - Enhanced with FreshPunk branding */
    #loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
    }

    .loading h2 {
      font-family: 'Poppins', sans-serif;
      font-size: 24px;
      font-weight: 800;
      margin: 0;
      text-align: center;
    }

    .loading p {
      font-size: 16px;
      font-weight: 500;
      margin: 0;
      opacity: 0.9;
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Auth Screen Styles - Enhanced with FreshPunk design */
    .auth-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
      padding: 20px;
    }

    .auth-box {
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      width: 100%;
      max-width: 450px;
      text-align: center;
      border: 2px solid var(--border-light);
    }

    .auth-box h1 {
      margin: 0 0 10px;
      font-family: 'Poppins', sans-serif;
      font-size: 28px;
      font-weight: 800;
      color: var(--text-primary);
      letter-spacing: -0.3px;
    }

    .auth-box p {
      margin: 0 0 30px;
      color: var(--text-secondary);
      font-size: 16px;
      font-weight: 500;
    }

    .brand-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .brand-icon {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 8px 16px rgba(76, 175, 80, 0.3);
    }

    .brand-text {
      font-family: 'Poppins', sans-serif;
      font-size: 24px;
      font-weight: 800;
      color: var(--text-primary);
    }

    .brand-text .fresh {
      color: var(--fresh-green);
    }

    .brand-text .punk {
      color: var(--punk-orange);
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-primary);
      font-size: 14px;
    }

    input, textarea, select {
      width: 100%;
      padding: 16px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 16px;
      font-weight: 500;
      box-sizing: border-box;
      background: var(--surface);
      transition: all 0.2s ease;
      font-family: 'Inter', sans-serif;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: var(--primary-green);
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    }

    .button {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'Inter', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }

    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(76, 175, 80, 0.4);
    }

    .button:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
    }

    .button.secondary {
      background: var(--surface-elevated);
      color: var(--text-primary);
      border: 2px solid var(--border);
      width: auto;
      padding: 12px 24px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .button.secondary:hover {
      background: var(--primary-green);
      color: white;
      border-color: var(--primary-green);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }

    .button.small {
      padding: 8px 16px;
      font-size: 14px;
      width: auto;
    }

    .button.warning {
      background: linear-gradient(135deg, var(--warning), #F57C00);
    }

    .button.info {
      background: linear-gradient(135deg, var(--info), #1976D2);
    }

    .button.purple {
      background: linear-gradient(135deg, var(--purple), #7B1FA2);
    }

    .auth-methods {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 20px;
    }

    .method-button {
      padding: 16px;
      background: var(--surface-elevated);
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 500;
      font-size: 16px;
    }

    .method-button:hover {
      border-color: var(--primary-green);
      background: rgba(76, 175, 80, 0.05);
    }

    /* Dashboard Styles - Enhanced with FreshPunk design */
    .dashboard {
      min-height: 100vh;
      background: var(--background);
    }
    
    .dashboard.hidden {
      display: none;
    }

    .dashboard-header {
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
      color: white;
      padding: 24px 0;
      box-shadow: 0 8px 32px rgba(76, 175, 80, 0.25);
      position: relative;
      overflow: hidden;
    }

    .dashboard-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.1) 50%, transparent 70%);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
      position: relative;
      z-index: 1;
    }

    .header-title {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header-title .brand-icon {
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .header-title h1 {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      font-size: 28px;
      font-weight: 800;
      letter-spacing: -0.3px;
    }

    .header-title p {
      margin: 5px 0 0;
      opacity: 0.9;
      font-size: 16px;
      font-weight: 500;
    }

    .header-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .main-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 32px 20px;
      background: var(--background);
    }

    /* Stats Grid - Enhanced with FreshPunk design */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--surface);
      border: 2px solid var(--border-light);
      border-radius: 20px;
      padding: 28px;
      text-align: center;
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
    }

    .stat-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 40px rgba(76, 175, 80, 0.15);
      border-color: var(--primary-green);
    }

    .stat-card.danger::before {
      background: linear-gradient(135deg, var(--error), #E53935);
    }

    .stat-card.warning::before {
      background: linear-gradient(135deg, var(--warning), #F57C00);
    }

    .stat-card.info::before {
      background: linear-gradient(135deg, var(--info), #1976D2);
    }

    .stat-value {
      font-size: 36px;
      font-weight: 900;
      font-family: 'Poppins', sans-serif;
      margin-bottom: 8px;
      color: var(--text-primary);
      letter-spacing: -0.5px;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .stat-sublabel {
      color: var(--text-light);
      font-size: 14px;
      margin-top: 4px;
      font-weight: 500;
    }

    /* Tabs - Enhanced with FreshPunk design */
    .tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 32px;
      background: var(--surface-elevated);
      padding: 6px;
      border-radius: 16px;
      border: 2px solid var(--border-light);
      overflow-x: auto;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    }

    .tab-button {
      flex: 1;
      min-width: 140px;
      padding: 16px 24px;
      background: transparent;
      border: none;
      border-radius: 12px;
      color: var(--text-secondary);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'Inter', sans-serif;
      white-space: nowrap;
      font-size: 16px;
    }

    .tab-button:hover {
      background: rgba(76, 175, 80, 0.1);
      color: var(--primary-green);
    }

    .tab-button.active {
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
      color: white;
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
      transform: translateY(-1px);
    }

    /* Tab Content - Enhanced with FreshPunk design */
    .tab-content {
      background: var(--surface);
      border: 2px solid var(--border-light);
      border-radius: 20px;
      padding: 32px;
      min-height: 500px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
      position: relative;
    }

    .tab-content.hidden {
      display: none;
    }

    /* Order Cards - Enhanced with FreshPunk design */
    .orders-grid {
      display: grid;
      gap: 20px;
    }

    .order-card {
      background: var(--surface-elevated);
      border: 2px solid var(--border-light);
      border-radius: 16px;
      padding: 24px;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .order-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
    }

    .order-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 32px rgba(76, 175, 80, 0.15);
      border-color: var(--primary-green);
    }

    .order-card.urgent::before {
      background: linear-gradient(135deg, var(--error), #E53935);
    }

    .order-card.preparing::before {
      background: linear-gradient(135deg, var(--warning), #F57C00);
    }

    .order-card.ready::before {
      background: linear-gradient(135deg, var(--success), #43A047);
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .order-id {
      font-weight: 700;
      color: var(--text-primary);
      font-size: 18px;
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
    }

    .order-status {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border: 2px solid transparent;
    }

    .status-pending {
      background: rgba(255, 152, 0, 0.15);
      color: var(--warning);
      border-color: var(--warning);
    }

    .status-preparing {
      background: rgba(33, 150, 243, 0.15);
      color: #2196F3;
      border-color: #2196F3;
    }

    .status-ready {
      background: rgba(76, 175, 80, 0.15);
      color: var(--success);
      border-color: var(--success);
    }

    .status-completed {
      background: rgba(156, 39, 176, 0.15);
      color: var(--purple);
      border-color: var(--purple);
    }

    .order-details {
      color: var(--text-secondary);
      font-size: 16px;
      margin-bottom: 16px;
      font-weight: 500;
      line-height: 1.5;
    }

    .order-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* Messages - Enhanced with FreshPunk design */
    .error-message {
      background: rgba(244, 67, 54, 0.15);
      color: var(--error);
      padding: 16px 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      display: none;
      font-size: 16px;
      font-weight: 600;
      border: 2px solid var(--error);
      box-shadow: 0 4px 16px rgba(244, 67, 54, 0.2);
    }

    .success-message {
      background: rgba(76, 175, 80, 0.15);
      color: var(--success);
      padding: 16px 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      display: none;
      font-size: 16px;
      font-weight: 600;
      border: 2px solid var(--success);
      box-shadow: 0 4px 16px rgba(76, 175, 80, 0.2);
    }

    .hidden {
      display: none !important;
    }

    /* Code Display Styles - Enhanced with FreshPunk design */
    .code-display {
      background: var(--surface-elevated);
      border: 2px dashed var(--border);
      border-radius: 16px;
      padding: 24px;
      margin: 24px 0;
      text-align: center;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    }

    .code-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 16px;
    }

    .code-item {
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
      color: white;
      padding: 12px 20px;
      border-radius: 12px;
      font-weight: 700;
      font-family: 'Inter', monospace;
      letter-spacing: 1px;
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }

    /* Advanced Features - Enhanced with FreshPunk design */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .action-card {
      background: var(--surface);
      border: 2px solid var(--border-light);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .action-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
    }

    .action-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 32px rgba(76, 175, 80, 0.15);
      border-color: var(--primary-green);
    }

    /* Filter and Search - Enhanced with FreshPunk design */
    .filter-bar {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      flex-wrap: wrap;
      align-items: center;
      background: var(--surface-elevated);
      padding: 20px;
      border-radius: 16px;
      border: 2px solid var(--border-light);
    }

    .search-input {
      flex: 1;
      min-width: 250px;
      padding: 16px 20px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.2s ease;
      background: var(--surface);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary-green);
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    }

    /* Analytics - Enhanced with FreshPunk design */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
    }

    .chart-container {
      background: var(--surface);
      border: 2px solid var(--border-light);
      border-radius: 20px;
      padding: 28px;
      height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        text-align: center;
      }

      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }

      .tabs {
        flex-direction: column;
      }

      .tab-button {
        text-align: center;
        min-width: auto;
      }

      .auth-box {
        padding: 30px 20px;
      }

      .order-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .main-content {
        padding: 20px 15px;
      }
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      :root {
        --background: #121212;
        --surface: #1E1E1E;
        --surface-elevated: #2A2A2A;
        --text-primary: #FFFFFF;
        --text-secondary: #BBBBBB;
        --text-light: #888888;
        --border: #333333;
      }
    }
  </style>
</head>

<body>
  <!-- Firebase v9 Compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-compat-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-compat-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-compat-functions.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-compat-firestore.js"></script>

  <!-- Loading Screen -->
  <div id="loading-screen" class="hidden">
    <div class="loading">
      <div class="spinner"></div>
      <h2>Loading Kitchen Pro Dashboard...</h2>
      <p>Preparing your advanced restaurant management tools</p>
    </div>
  </div>

  <!-- Authentication Screen -->
  <div id="auth-screen" class="auth-container">
    <!-- Method Selection -->
    <div id="auth-method-selection" class="auth-box">
      <div class="brand-header">
        <div class="brand-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7z" fill="white"/>
            <path d="M16 6v8h2.5v8H21V2c0-1.1-.9-2-2-2h-3v6z" fill="white"/>
          </svg>
        </div>
        <div class="brand-text">
          <span class="fresh">Fresh</span><span class="punk">Punk</span>
        </div>
      </div>
      
      <h1>Kitchen Pro</h1>
      <p>Advanced restaurant management dashboard - Choose your login method</p>
      
      <div class="auth-methods">
        <button class="method-button" onclick="showFirebaseAuth()">
          üîê Firebase Login (Recommended)
        </button>
        <button class="method-button" onclick="showAccessCodeAuth()">
          üîë Use Access Code
        </button>
        <button class="method-button" onclick="showGuestAccess()">
          üë§ Guest Access (Limited)
        </button>
      </div>
    </div>

    <!-- Access Code Authentication -->
    <div id="access-code-auth" class="auth-box hidden">
      <h1>üîë Access Code Login</h1>
      <p>Enter your kitchen access code to continue</p>
      
      <form id="access-code-form">
        <div class="form-group">
          <label for="access-code">Kitchen Access Code</label>
          <input type="text" id="access-code" required placeholder="Enter your access code" autocomplete="off">
        </div>
        
        <button type="submit" class="button">Access Kitchen Dashboard</button>
      </form>

      <div class="code-display">
        <h3>Available Access Codes:</h3>
        <div class="code-list">
          <span class="code-item">KITCHEN001</span>
          <span class="code-item">KITCHEN002</span>
          <span class="code-item">KITCHEN003</span>
          <span class="code-item">KITCHENPRO</span>
        </div>
      </div>

      <button type="button" class="button secondary" onclick="showAuthMethodSelection()" style="margin-top: 20px;">‚Üê Back to Login Options</button>
    </div>

    <!-- Firebase Authentication -->
    <div id="firebase-auth" class="auth-box hidden">
      <h1>üîê Firebase Login</h1>
      <p>Sign in with your Firebase account for full access</p>
      
      <form id="firebase-auth-form">
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" required placeholder="your@email.com">
        </div>
        
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" required placeholder="Your password">
        </div>
        
        <button type="submit" class="button">Sign In</button>
      </form>

      <button type="button" class="button secondary" onclick="showAuthMethodSelection()" style="margin-top: 20px;">‚Üê Back to Login Options</button>
    </div>

    <!-- Guest Access -->
    <div id="guest-access" class="auth-box hidden">
      <h1>üë§ Guest Access</h1>
      <p>Enter as a guest with limited dashboard access</p>
      
      <form id="guest-form">
        <div class="form-group">
          <label for="guest-name">Your Name</label>
          <input type="text" id="guest-name" required placeholder="Enter your name">
        </div>
        
        <div class="form-group">
          <label for="guest-role">Role</label>
          <select id="guest-role" required>
            <option value="">Select your role</option>
            <option value="manager">Kitchen Manager</option>
            <option value="chef">Head Chef</option>
            <option value="staff">Kitchen Staff</option>
            <option value="observer">Observer</option>
          </select>
        </div>
        
        <button type="submit" class="button warning">Enter as Guest</button>
      </form>

      <div style="margin: 20px 0; padding: 15px; background: rgba(255, 152, 0, 0.1); border-radius: 8px; font-size: 14px;">
        <strong>Note:</strong> Guest access provides read-only access to basic dashboard features.
      </div>

      <button type="button" class="button secondary" onclick="showAuthMethodSelection()" style="margin-top: 20px;">‚Üê Back to Login Options</button>
    </div>

    <!-- Registration Screen -->
    <div id="registration-screen" class="auth-box hidden">
      <h1>üìù Kitchen Registration</h1>
      <p>Complete your kitchen profile</p>
      
      <form id="registration-form">
        <div class="form-group">
          <label for="kitchen-name">Kitchen Name</label>
          <input type="text" id="kitchen-name" required placeholder="Your kitchen name">
        </div>
        
        <div class="form-group">
          <label for="kitchen-email">Contact Email</label>
          <input type="email" id="kitchen-email" required placeholder="contact@kitchen.com">
        </div>
        
        <div class="form-group">
          <label for="kitchen-phone">Phone Number</label>
          <input type="tel" id="kitchen-phone" required placeholder="(555) 123-4567">
        </div>
        
        <div class="form-group">
          <label for="kitchen-address">Kitchen Address</label>
          <textarea id="kitchen-address" required placeholder="Full kitchen address" rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label for="kitchen-type">Kitchen Type</label>
          <select id="kitchen-type" required>
            <option value="">Select kitchen type</option>
            <option value="restaurant">Restaurant</option>
            <option value="cafe">Cafe</option>
            <option value="food-truck">Food Truck</option>
            <option value="catering">Catering</option>
            <option value="cloud-kitchen">Cloud Kitchen</option>
          </select>
        </div>
        
        <button type="submit" class="button">Complete Registration</button>
      </form>

      <button type="button" class="button secondary" onclick="goBackToAuth()">‚Üê Back to Access Code</button>
    </div>

    <!-- Error/Success Messages -->
    <div id="error-message" class="error-message"></div>
    <div id="success-message" class="success-message"></div>
  </div>

  <!-- Kitchen Dashboard -->
  <div id="kitchen-dashboard" class="dashboard hidden">
    <!-- Header -->
    <div class="dashboard-header">
      <div class="header-content">
        <div class="header-title">
          <h1>üçΩÔ∏è FreshPunk Kitchen Pro</h1>
          <p id="kitchen-name-display">Loading...</p>
        </div>
        <div class="header-actions">
          <button class="button secondary" onclick="showAddMealForm()">+ Add Meal</button>
          <button class="button secondary" onclick="exportData()">üìä Export</button>
          <button class="button secondary" onclick="refreshDashboard()">üîÑ Refresh</button>
          <button class="button secondary" onclick="showSettings()">‚öôÔ∏è Settings</button>
          <button class="button secondary" onclick="signOut()">Logout</button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Quick Stats -->
      <div class="stats-grid">
        <div class="stat-card" onclick="showOrdersTab()">
          <div class="stat-value" style="color: var(--primary-green);" id="active-orders">12</div>
          <div class="stat-label">Active Orders</div>
          <div class="stat-sublabel">Currently being processed</div>
        </div>
        <div class="stat-card" onclick="showPreparingFilter()">
          <div class="stat-value" style="color: var(--warning);" id="preparing-orders">7</div>
          <div class="stat-label">Preparing</div>
          <div class="stat-sublabel">In the kitchen now</div>
        </div>
        <div class="stat-card" onclick="showAnalyticsTab()">
          <div class="stat-value" style="color: var(--info);" id="completed-today">28</div>
          <div class="stat-label">Completed Today</div>
          <div class="stat-sublabel">Revenue: $<span id="today-revenue">847</span></div>
        </div>
        <div class="stat-card" onclick="showMealsTab()">
          <div class="stat-value" style="color: var(--purple);" id="available-meals">15</div>
          <div class="stat-label">Available Meals</div>
          <div class="stat-sublabel">Ready to order</div>
        </div>
        <div class="stat-card" onclick="showInventoryTab()">
          <div class="stat-value" style="color: var(--error);" id="low-stock-items">3</div>
          <div class="stat-label">Low Stock Items</div>
          <div class="stat-sublabel">Need attention</div>
        </div>
        <div class="stat-card" onclick="showStaffTab()">
          <div class="stat-value" style="color: var(--success);" id="staff-online">4</div>
          <div class="stat-label">Staff Online</div>
          <div class="stat-sublabel">Active right now</div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <div class="action-card" onclick="createNewOrder()">
          <h3>üìù New Order</h3>
          <p>Create manual order</p>
        </div>
        <div class="action-card" onclick="emergencyMode()">
          <h3>üö® Emergency Mode</h3>
          <p>Rush orders priority</p>
        </div>
        <div class="action-card" onclick="dailyReport()">
          <h3>üìã Daily Report</h3>
          <p>Generate summary</p>
        </div>
        <div class="action-card" onclick="notifyStaff()">
          <h3>üì¢ Notify Staff</h3>
          <p>Send announcements</p>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs">
        <button class="tab-button active" onclick="showTab('orders')" id="tab-orders">üìã Orders</button>
        <button class="tab-button" onclick="showTab('meals')" id="tab-meals">üçΩÔ∏è Meals</button>
        <button class="tab-button" onclick="showTab('analytics')" id="tab-analytics">üìä Analytics</button>
        <button class="tab-button" onclick="showTab('inventory')" id="tab-inventory">üì¶ Inventory</button>
        <button class="tab-button" onclick="showTab('staff')" id="tab-staff">üë• Staff</button>
        <button class="tab-button" onclick="showTab('settings')" id="tab-settings">‚öôÔ∏è Settings</button>
      </div>

      <!-- Tab Content -->
      <div id="tab-content">
        <!-- Orders Tab (Default) -->
        <div id="orders-content" class="tab-content">
          <div class="filter-bar">
            <input type="text" class="search-input" placeholder="Search orders..." id="order-search">
            <button class="button small active" onclick="filterOrders('all')" id="filter-all">All</button>
            <button class="button small" onclick="filterOrders('pending')" id="filter-pending">Pending</button>
            <button class="button small" onclick="filterOrders('preparing')" id="filter-preparing">Preparing</button>
            <button class="button small" onclick="filterOrders('ready')" id="filter-ready">Ready</button>
            <button class="button small" onclick="filterOrders('completed')" id="filter-completed">Completed</button>
          </div>
          
          <div id="orders-list" class="orders-grid">
            <!-- Orders will be loaded here -->
          </div>
        </div>

        <!-- Meals Tab -->
        <div id="meals-content" class="tab-content hidden">
          <div class="filter-bar">
            <input type="text" class="search-input" placeholder="Search meals..." id="meal-search">
            <button class="button small" onclick="addNewMeal()">+ Add New Meal</button>
            <button class="button small" onclick="importMeals()">üì• Import</button>
            <button class="button small" onclick="exportMeals()">üì§ Export</button>
          </div>
          
          <div id="meals-grid" class="analytics-grid">
            <!-- Meals will be loaded here -->
          </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-content" class="tab-content hidden">
          <div class="analytics-grid">
            <div class="chart-container">
              <div>
                <h3>üìà Daily Sales Trend</h3>
                <p>Chart visualization coming soon</p>
              </div>
            </div>
            <div class="chart-container">
              <div>
                <h3>üçΩÔ∏è Popular Meals</h3>
                <p>Top ordered items today</p>
              </div>
            </div>
            <div class="chart-container">
              <div>
                <h3>‚è±Ô∏è Average Prep Time</h3>
                <p>Kitchen efficiency metrics</p>
              </div>
            </div>
            <div class="chart-container">
              <div>
                <h3>üí∞ Revenue Breakdown</h3>
                <p>Income analysis</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Inventory Tab -->
        <div id="inventory-content" class="tab-content hidden">
          <div class="filter-bar">
            <input type="text" class="search-input" placeholder="Search inventory..." id="inventory-search">
            <button class="button small warning" onclick="showLowStock()">‚ö†Ô∏è Low Stock</button>
            <button class="button small" onclick="addInventoryItem()">+ Add Item</button>
            <button class="button small" onclick="orderSupplies()">üõí Order Supplies</button>
          </div>
          
          <div id="inventory-list">
            <p>Inventory management features coming soon...</p>
          </div>
        </div>

        <!-- Staff Tab -->
        <div id="staff-content" class="tab-content hidden">
          <div class="filter-bar">
            <input type="text" class="search-input" placeholder="Search staff..." id="staff-search">
            <button class="button small" onclick="addStaffMember()">+ Add Staff</button>
            <button class="button small" onclick="scheduleShift()">üìÖ Schedule</button>
            <button class="button small" onclick="performanceReview()">‚≠ê Reviews</button>
          </div>
          
          <div id="staff-list">
            <p>Staff management features coming soon...</p>
          </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings-content" class="tab-content hidden">
          <h2>‚öôÔ∏è Dashboard Settings</h2>
          
          <div style="display: grid; gap: 20px; margin-top: 20px;">
            <div class="action-card" onclick="toggleNotifications()">
              <h3>üîî Notifications</h3>
              <p>Manage alert preferences</p>
            </div>
            <div class="action-card" onclick="themeSettings()">
              <h3>üé® Theme</h3>
              <p>Customize dashboard appearance</p>
            </div>
            <div class="action-card" onclick="dataSettings()">
              <h3>üíæ Data</h3>
              <p>Backup and export options</p>
            </div>
            <div class="action-card" onclick="integrationSettings()">
              <h3>üîó Integrations</h3>
              <p>Connect external services</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let currentUser = null;
    let kitchenData = null;
    let currentAuthMethod = null;
    let currentFilter = 'all';
    let currentTab = 'orders';

    // Valid access codes (including the new PRO code)
    const validCodes = ['KITCHEN001', 'KITCHEN002', 'KITCHEN003', 'KITCHENPRO'];

    // DOM elements
    const authScreen = document.getElementById('auth-screen');
    const loadingScreen = document.getElementById('loading-screen');
    const kitchenDashboard = document.getElementById('kitchen-dashboard');
    const errorMessage = document.getElementById('error-message');
    const successMessage = document.getElementById('success-message');

    // Show/hide screens
    function showScreen(screenId) {
      console.log('showScreen called with:', screenId);
      
      document.querySelectorAll('.auth-container, .dashboard, #loading-screen').forEach(el => {
        el.classList.add('hidden');
      });
      
      const targetElement = document.getElementById(screenId);
      if (targetElement) {
        targetElement.classList.remove('hidden');
        console.log('Screen', screenId, 'should now be visible');
      } else {
        console.error('Element with ID', screenId, 'not found');
      }
    }

    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
      successMessage.style.display = 'none';
    }

    function showSuccess(message) {
      successMessage.textContent = message;
      successMessage.style.display = 'block';
      errorMessage.style.display = 'none';
    }

    function hideMessages() {
      errorMessage.style.display = 'none';
      successMessage.style.display = 'none';
    }

    // Authentication method selection
    window.showAuthMethodSelection = function() {
      document.getElementById('auth-method-selection').classList.remove('hidden');
      document.getElementById('access-code-auth').classList.add('hidden');
      document.getElementById('firebase-auth').classList.add('hidden');
      document.getElementById('guest-access').classList.add('hidden');
      document.getElementById('registration-screen').classList.add('hidden');
      hideMessages();
    };

    window.showAccessCodeAuth = function() {
      document.getElementById('auth-method-selection').classList.add('hidden');
      document.getElementById('access-code-auth').classList.remove('hidden');
      document.getElementById('firebase-auth').classList.add('hidden');
      document.getElementById('guest-access').classList.add('hidden');
      currentAuthMethod = 'access-code';
      hideMessages();
    };

    window.showFirebaseAuth = function() {
      document.getElementById('auth-method-selection').classList.add('hidden');
      document.getElementById('access-code-auth').classList.add('hidden');
      document.getElementById('firebase-auth').classList.remove('hidden');
      document.getElementById('guest-access').classList.add('hidden');
      currentAuthMethod = 'firebase';
      hideMessages();
    };

    window.showGuestAccess = function() {
      document.getElementById('auth-method-selection').classList.add('hidden');
      document.getElementById('access-code-auth').classList.add('hidden');
      document.getElementById('firebase-auth').classList.add('hidden');
      document.getElementById('guest-access').classList.remove('hidden');
      currentAuthMethod = 'guest';
      hideMessages();
    };

    // Access code authentication
    document.getElementById('access-code-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const code = document.getElementById('access-code').value.trim().toUpperCase();
      hideMessages();

      if (!code) {
        showError('Please enter an access code');
        return;
      }

      if (!validCodes.includes(code)) {
        showError('Invalid access code');
        return;
      }

      showScreen('loading-screen');
      
      // Store access code and check if registered
      sessionStorage.setItem('kitchen_code', code);
      const existingData = sessionStorage.getItem('kitchen_data_pro');
      
      setTimeout(() => {
        if (existingData) {
          kitchenData = JSON.parse(existingData);
          sessionStorage.setItem('kitchen_access_pro', 'true');
          showSuccess('Welcome back! Loading dashboard...');
          setTimeout(() => showKitchenDashboard(), 1000);
        } else {
          showKitchenRegistration();
        }
      }, 1000);
    });

    // Firebase authentication
    document.getElementById('firebase-auth-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      hideMessages();
      showScreen('loading-screen');

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        const idTokenResult = await user.getIdTokenResult();
        const isKitchen = idTokenResult.claims.kitchen || false;

        if (!isKitchen) {
          throw new Error('Access denied. Kitchen partner role required.');
        }

        currentUser = user;
        kitchenData = {
          name: idTokenResult.claims.kitchenName || 'Firebase Kitchen Pro',
          email: user.email,
          method: 'firebase',
          uid: user.uid,
          accessLevel: 'full'
        };

        sessionStorage.setItem('kitchen_access_pro', 'true');
        sessionStorage.setItem('kitchen_data_pro', JSON.stringify(kitchenData));
        showSuccess('Firebase authentication successful!');
        setTimeout(() => showKitchenDashboard(), 1000);

      } catch (error) {
        console.error('Authentication error:', error);
        showError(error.message || 'Authentication failed. Please check your credentials.');
        showScreen('auth-screen');
      }
    });

    // Guest access
    document.getElementById('guest-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const name = document.getElementById('guest-name').value.trim();
      const role = document.getElementById('guest-role').value;

      if (!name || !role) {
        showError('Please fill in all fields');
        return;
      }

      showScreen('loading-screen');

      kitchenData = {
        name: name + ' (Guest)',
        role: role,
        method: 'guest',
        accessLevel: 'limited',
        guestAccess: true
      };

      sessionStorage.setItem('kitchen_access_pro', 'guest');
      sessionStorage.setItem('kitchen_data_pro', JSON.stringify(kitchenData));
      
      showSuccess('Guest access granted! Loading limited dashboard...');
      setTimeout(() => showKitchenDashboard(), 1500);
    });

    // Kitchen registration
    function showKitchenRegistration() {
      document.getElementById('auth-method-selection').classList.add('hidden');
      document.getElementById('access-code-auth').classList.add('hidden');
      document.getElementById('firebase-auth').classList.add('hidden');
      document.getElementById('guest-access').classList.add('hidden');
      document.getElementById('registration-screen').classList.remove('hidden');
      showScreen('auth-screen');
    }

    document.getElementById('registration-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const name = document.getElementById('kitchen-name').value.trim();
      const email = document.getElementById('kitchen-email').value.trim();
      const phone = document.getElementById('kitchen-phone').value.trim();
      const address = document.getElementById('kitchen-address').value.trim();
      const type = document.getElementById('kitchen-type').value;
      const code = sessionStorage.getItem('kitchen_code');

      if (!name || !email || !phone || !address || !type) {
        showError('Please fill in all fields');
        return;
      }

      kitchenData = {
        name: name,
        email: email,
        phone: phone,
        address: address,
        type: type,
        code: code,
        registeredAt: new Date().toISOString(),
        method: 'access-code',
        accessLevel: code === 'KITCHENPRO' ? 'full' : 'standard'
      };

      sessionStorage.setItem('kitchen_access_pro', 'true');
      sessionStorage.setItem('kitchen_data_pro', JSON.stringify(kitchenData));
      
      showScreen('loading-screen');
      showSuccess('Registration complete! Welcome to Kitchen Pro!');
      setTimeout(() => showKitchenDashboard(), 2000);
    });

    window.goBackToAuth = function() {
      showScreen('auth-screen');
      showAccessCodeAuth();
    };

    // Kitchen Dashboard
    function showKitchenDashboard() {
      console.log('showKitchenDashboard called');
      console.log('kitchenData:', kitchenData);
      
      showScreen('kitchen-dashboard');
      
      const nameDisplay = document.getElementById('kitchen-name-display');
      if (nameDisplay && kitchenData) {
        let displayText = kitchenData.name;
        if (kitchenData.accessLevel) {
          displayText += ` (${kitchenData.accessLevel === 'full' ? 'Full Access' : 'Standard Access'})`;
        }
        nameDisplay.textContent = displayText;
        console.log('Kitchen name set to:', displayText);
      } else {
        console.error('Missing kitchen name display element or kitchenData');
      }
      
      // Hide guest-only features if limited access
      if (kitchenData.guestAccess) {
        document.querySelectorAll('.button.secondary').forEach(btn => {
          if (btn.textContent.includes('Add') || btn.textContent.includes('Export') || btn.textContent.includes('Settings')) {
            btn.style.opacity = '0.5';
            btn.style.pointerEvents = 'none';
          }
        });
      }
      
      loadOrders();
      updateStats();
      console.log('Dashboard should now be visible');
    }

    // Dashboard functions
    window.showTab = function(tabName) {
      currentTab = tabName;
      
      // Update tab buttons
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.getElementById('tab-' + tabName).classList.add('active');

      // Show content
      document.querySelectorAll('[id$="-content"]').forEach(content => content.classList.add('hidden'));
      document.getElementById(tabName + '-content').classList.remove('hidden');

      // Load specific content
      switch(tabName) {
        case 'orders':
          loadOrders();
          break;
        case 'meals':
          loadMeals();
          break;
        case 'analytics':
          loadAnalytics();
          break;
        case 'inventory':
          loadInventory();
          break;
        case 'staff':
          loadStaff();
          break;
      }
    };

    // Quick access functions
    window.showOrdersTab = function() { showTab('orders'); };
    window.showMealsTab = function() { showTab('meals'); };
    window.showAnalyticsTab = function() { showTab('analytics'); };
    window.showInventoryTab = function() { showTab('inventory'); };
    window.showStaffTab = function() { showTab('staff'); };

    window.showPreparingFilter = function() {
      showTab('orders');
      setTimeout(() => filterOrders('preparing'), 100);
    };

    window.filterOrders = function(status) {
      currentFilter = status;
      document.querySelectorAll('[id^="filter-"]').forEach(btn => btn.classList.remove('active'));
      document.getElementById('filter-' + status).classList.add('active');
      loadOrders();
    };

    window.updateOrderStatus = function(orderId, newStatus) {
      showSuccess(`Order ${orderId} status updated to: ${newStatus.toUpperCase()}`);
      setTimeout(() => {
        loadOrders();
        updateStats();
      }, 500);
    };

    // Action functions
    window.showAddMealForm = function() {
      if (kitchenData.guestAccess) {
        showError('Guest access: Adding meals not available');
        return;
      }
      showSuccess('Add Meal feature coming soon!');
    };

    window.exportData = function() {
      if (kitchenData.guestAccess) {
        showError('Guest access: Export not available');
        return;
      }
      showSuccess('Export feature coming soon!');
    };

    window.refreshDashboard = function() {
      showScreen('loading-screen');
      setTimeout(() => {
        loadOrders();
        updateStats();
        showScreen('kitchen-dashboard');
        showSuccess('Dashboard refreshed!');
      }, 1000);
    };

    window.showSettings = function() {
      showTab('settings');
    };

    window.signOut = function() {
      if (currentUser) {
        auth.signOut();
      }
      sessionStorage.clear();
      currentUser = null;
      kitchenData = null;
      showScreen('auth-screen');
      showAuthMethodSelection();
      showSuccess('Signed out successfully');
    };

    // Additional action functions
    window.createNewOrder = function() {
      if (kitchenData.guestAccess) {
        showError('Guest access: Creating orders not available');
        return;
      }
      
      const orderData = {
        id: 'ORD-' + String(Date.now()).slice(-6),
        customer: prompt('Customer name:') || 'Walk-in Customer',
        items: ['Custom Order'],
        status: 'pending',
        time: 'Just now',
        total: '$' + (Math.random() * 30 + 10).toFixed(2),
        priority: 'normal'
      };
      
      showSuccess(`New order ${orderData.id} created for ${orderData.customer}!`);
      setTimeout(() => {
        loadOrders();
        updateStats();
      }, 1000);
    };

    window.emergencyMode = function() {
      const isEmergency = confirm('Enable Emergency Mode? This will prioritize all new orders and notify staff.');
      if (isEmergency) {
        document.body.style.background = 'linear-gradient(135deg, #ff5722, #f44336)';
        showSuccess('üö® EMERGENCY MODE ACTIVATED! All hands on deck!');
        setTimeout(() => {
          document.body.style.background = '';
          showSuccess('Emergency mode deactivated');
        }, 10000);
      }
    };

    window.dailyReport = function() {
      showScreen('loading-screen');
      setTimeout(() => {
        const report = {
          totalOrders: Math.floor(Math.random() * 50) + 30,
          revenue: '$' + (Math.random() * 2000 + 1000).toFixed(2),
          avgPrepTime: Math.floor(Math.random() * 10) + 15 + ' minutes',
          topMeal: 'Grilled Chicken Bowl'
        };
        
        showScreen('kitchen-dashboard');
        alert(`üìã DAILY REPORT\n\nTotal Orders: ${report.totalOrders}\nRevenue: ${report.revenue}\nAvg Prep Time: ${report.avgPrepTime}\nTop Meal: ${report.topMeal}`);
      }, 2000);
    };

    window.notifyStaff = function() {
      const message = prompt('Enter message to send to all kitchen staff:');
      if (message) {
        showSuccess(`üì¢ Notification sent to all staff: "${message}"`);
      }
    };

    // Settings functions
    window.toggleNotifications = function() {
      const enabled = confirm('Enable push notifications for new orders?');
      showSuccess(enabled ? 'üîî Notifications enabled!' : 'üîï Notifications disabled');
    };

    window.themeSettings = function() {
      const theme = prompt('Choose theme:\n1. Light (default)\n2. Dark\n3. Green\n4. Professional\n\nEnter number (1-4):');
      const themes = {
        '1': 'Light theme applied',
        '2': 'Dark theme applied',
        '3': 'Green theme applied', 
        '4': 'Professional theme applied'
      };
      if (themes[theme]) {
        showSuccess(`üé® ${themes[theme]}!`);
      }
    };

    window.dataSettings = function() {
      const action = prompt('Data options:\n1. Backup data\n2. Export CSV\n3. Clear cache\n4. Reset dashboard\n\nEnter number (1-4):');
      const actions = {
        '1': 'Data backup initiated',
        '2': 'CSV export started',
        '3': 'Cache cleared successfully',
        '4': 'Dashboard reset completed'
      };
      if (actions[action]) {
        showSuccess(`üíæ ${actions[action]}!`);
      }
    };

    window.integrationSettings = function() {
      const service = prompt('Connect to:\n1. POS System\n2. Delivery Apps\n3. Inventory Management\n4. Accounting Software\n\nEnter number (1-4):');
      const services = {
        '1': 'POS System integration setup',
        '2': 'Delivery Apps connected',
        '3': 'Inventory Management linked',
        '4': 'Accounting Software synced'
      };
      if (services[service]) {
        showSuccess(`üîó ${services[service]}!`);
      }
    };

    // Meal management functions
    window.addNewMeal = function() {
      if (kitchenData.guestAccess) {
        showError('Guest access: Adding meals not available');
        return;
      }
      
      const name = prompt('Meal name:');
      const price = prompt('Price ($):');
      if (name && price) {
        showSuccess(`‚úÖ New meal "${name}" added for $${price}!`);
        setTimeout(() => loadMeals(), 500);
      }
    };

    window.importMeals = function() {
      if (kitchenData.guestAccess) {
        showError('Guest access: Import not available');
        return;
      }
      showSuccess('üì• Meal import feature coming soon!');
    };

    window.exportMeals = function() {
      if (kitchenData.guestAccess) {
        showError('Guest access: Export not available');
        return;
      }
      showSuccess('üì§ Exporting meal data...');
    };

    // Inventory functions
    window.showLowStock = function() {
      filterInventory('low-stock');
      showSuccess('‚ö†Ô∏è Showing items with low stock levels');
    };

    window.addInventoryItem = function() {
      if (kitchenData.guestAccess) {
        showError('Guest access: Adding inventory not available');
        return;
      }
      
      const item = prompt('Item name:');
      const quantity = prompt('Current quantity:');
      if (item && quantity) {
        showSuccess(`üì¶ Added "${item}" (${quantity} units) to inventory!`);
      }
    };

    window.orderSupplies = function() {
      if (kitchenData.guestAccess) {
        showError('Guest access: Ordering supplies not available');
        return;
      }
      showSuccess('üõí Supply order interface opening...');
    };

    window.filterInventory = function(type) {
      // Implementation for inventory filtering
      showSuccess(`Filtering inventory by: ${type}`);
    };

    // Staff management functions
    window.addStaffMember = function() {
      if (kitchenData.guestAccess) {
        showError('Guest access: Staff management not available');
        return;
      }
      
      const name = prompt('Staff member name:');
      const role = prompt('Role (chef/cook/server/manager):');
      if (name && role) {
        showSuccess(`üë§ Added ${name} as ${role} to the team!`);
      }
    };

    window.scheduleShift = function() {
      if (kitchenData.guestAccess) {
        showError('Guest access: Scheduling not available');
        return;
      }
      showSuccess('üìÖ Opening shift scheduling interface...');
    };

    window.performanceReview = function() {
      if (kitchenData.guestAccess) {
        showError('Guest access: Performance reviews not available');
        return;
      }
      showSuccess('‚≠ê Performance review system coming soon!');
    };

    // Load functions
    function loadOrders() {
      const ordersList = document.getElementById('orders-list');
      
      const sampleOrders = [
        {
          id: 'ORD-001',
          customer: 'John Doe',
          items: ['Grilled Chicken Bowl', 'Caesar Salad'],
          status: 'pending',
          time: '10 mins ago',
          total: '$24.50',
          priority: 'normal'
        },
        {
          id: 'ORD-002',
          customer: 'Jane Smith',
          items: ['Veggie Wrap', 'Smoothie Bowl'],
          status: 'preparing',
          time: '15 mins ago',
          total: '$18.75',
          priority: 'high'
        },
        {
          id: 'ORD-003',
          customer: 'Mike Johnson',
          items: ['Protein Bowl', 'Fresh Juice'],
          status: 'ready',
          time: '5 mins ago',
          total: '$21.25',
          priority: 'normal'
        },
        {
          id: 'ORD-004',
          customer: 'Sarah Wilson',
          items: ['Keto Bowl', 'Green Smoothie'],
          status: 'completed',
          time: '25 mins ago',
          total: '$27.00',
          priority: 'normal'
        }
      ];

      // Filter orders based on current filter
      const filteredOrders = currentFilter === 'all' 
        ? sampleOrders 
        : sampleOrders.filter(order => order.status === currentFilter);

      ordersList.innerHTML = filteredOrders.map(order => `
        <div class="order-card">
          <div class="order-header">
            <span class="order-id">${order.id}</span>
            <span class="order-status status-${order.status}">${order.status}</span>
          </div>
          <div class="order-details">
            <strong>${order.customer}</strong> ${order.priority === 'high' ? 'üî•' : ''}<br>
            ${order.items.join(', ')}<br>
            <small>${order.time} ‚Ä¢ ${order.total}</small>
          </div>
          <div class="order-actions">
            ${order.status === 'pending' ? `<button class="button small" onclick="updateOrderStatus('${order.id}', 'preparing')">Start Preparing</button>` : ''}
            ${order.status === 'preparing' ? `<button class="button small" onclick="updateOrderStatus('${order.id}', 'ready')">Mark Ready</button>` : ''}
            ${order.status === 'ready' ? `<button class="button small" onclick="updateOrderStatus('${order.id}', 'completed')">Complete</button>` : ''}
          </div>
        </div>
      `).join('');
    }

    function loadMeals() {
      const mealsGrid = document.getElementById('meals-grid');
      
      const sampleMeals = [
        { name: 'Grilled Chicken Bowl', price: '$14.99', category: 'Protein', status: 'available', orders: 23 },
        { name: 'Veggie Wrap', price: '$11.99', category: 'Vegetarian', status: 'available', orders: 18 },
        { name: 'Caesar Salad', price: '$9.99', category: 'Salads', status: 'available', orders: 15 },
        { name: 'Protein Smoothie', price: '$7.99', category: 'Beverages', status: 'limited', orders: 12 },
        { name: 'Keto Bowl', price: '$16.99', category: 'Specialty', status: 'available', orders: 8 },
        { name: 'Fresh Juice', price: '$5.99', category: 'Beverages', status: 'unavailable', orders: 5 }
      ];

      mealsGrid.innerHTML = sampleMeals.map(meal => `
        <div class="stat-card" onclick="editMeal('${meal.name}')" style="cursor: pointer;">
          <div class="stat-value" style="font-size: 24px; color: ${meal.status === 'available' ? 'var(--success)' : meal.status === 'limited' ? 'var(--warning)' : 'var(--error)'};">
            ${meal.price}
          </div>
          <div class="stat-label">${meal.name}</div>
          <div class="stat-sublabel">${meal.category} ‚Ä¢ ${meal.orders} orders today</div>
          <div style="margin-top: 10px;">
            <span style="padding: 4px 8px; border-radius: 12px; font-size: 11px; background: ${meal.status === 'available' ? 'rgba(76, 175, 80, 0.1)' : meal.status === 'limited' ? 'rgba(255, 152, 0, 0.1)' : 'rgba(244, 67, 54, 0.1)'}; color: ${meal.status === 'available' ? 'var(--success)' : meal.status === 'limited' ? 'var(--warning)' : 'var(--error)'};">
              ${meal.status.toUpperCase()}
            </span>
          </div>
        </div>
      `).join('');
    }

    window.editMeal = function(mealName) {
      if (kitchenData.guestAccess) {
        showError('Guest access: Editing meals not available');
        return;
      }
      
      const action = prompt(`Edit "${mealName}":\n1. Change price\n2. Update status\n3. Edit description\n4. View analytics\n\nEnter number (1-4):`);
      
      if (action === '1') {
        const newPrice = prompt('Enter new price:');
        if (newPrice) showSuccess(`Price updated to $${newPrice}`);
      } else if (action === '2') {
        const status = prompt('Status:\n1. Available\n2. Limited\n3. Unavailable\n\nEnter number:');
        const statuses = { '1': 'available', '2': 'limited', '3': 'unavailable' };
        if (statuses[status]) {
          showSuccess(`Status changed to ${statuses[status]}`);
          setTimeout(() => loadMeals(), 500);
        }
      } else if (action === '3') {
        const desc = prompt('Enter new description:');
        if (desc) showSuccess('Description updated!');
      } else if (action === '4') {
        alert(`üìä MEAL ANALYTICS for "${mealName}"\n\nToday's Orders: ${Math.floor(Math.random() * 25) + 5}\nRevenue: $${(Math.random() * 200 + 50).toFixed(2)}\nAvg Rating: ${(Math.random() * 2 + 3).toFixed(1)}/5\nPrep Time: ${Math.floor(Math.random() * 10) + 8} min`);
      }
    };

    function loadAnalytics() {
      const analyticsContent = document.getElementById('analytics-content');
      analyticsContent.innerHTML = `
        <div class="analytics-grid">
          <div class="chart-container" onclick="showSalesAnalytics()" style="cursor: pointer;">
            <div>
              <h3>üìà Daily Sales Trend</h3>
              <div class="stat-value" style="color: var(--success); font-size: 24px;">+15.3%</div>
              <p>Revenue increased vs yesterday</p>
              <div class="stat-sublabel">Click for detailed view</div>
            </div>
          </div>
          <div class="chart-container" onclick="showPopularMeals()" style="cursor: pointer;">
            <div>
              <h3>üçΩÔ∏è Popular Meals</h3>
              <div class="stat-value" style="color: var(--info); font-size: 20px;">Chicken Bowl</div>
              <p>Top ordered item today (23 orders)</p>
              <div class="stat-sublabel">Click to see full ranking</div>
            </div>
          </div>
          <div class="chart-container" onclick="showPrepTimeAnalytics()" style="cursor: pointer;">
            <div>
              <h3>‚è±Ô∏è Average Prep Time</h3>
              <div class="stat-value" style="color: var(--warning); font-size: 24px;">18 min</div>
              <p>2 minutes faster than yesterday</p>
              <div class="stat-sublabel">Click for efficiency report</div>
            </div>
          </div>
          <div class="chart-container" onclick="showRevenueBreakdown()" style="cursor: pointer;">
            <div>
              <h3>üí∞ Revenue Breakdown</h3>
              <div class="stat-value" style="color: var(--purple); font-size: 24px;">$2,847</div>
              <p>Today's total revenue</p>
              <div class="stat-sublabel">Click for detailed breakdown</div>
            </div>
          </div>
          <div class="chart-container" onclick="showCustomerAnalytics()" style="cursor: pointer;">
            <div>
              <h3>üë• Customer Analytics</h3>
              <div class="stat-value" style="color: var(--primary-green); font-size: 24px;">89</div>
              <p>Unique customers today</p>
              <div class="stat-sublabel">Click for customer insights</div>
            </div>
          </div>
          <div class="chart-container" onclick="showStaffEfficiency()" style="cursor: pointer;">
            <div>
              <h3>‚≠ê Staff Efficiency</h3>
              <div class="stat-value" style="color: var(--success); font-size: 24px;">94%</div>
              <p>Overall team performance</p>
              <div class="stat-sublabel">Click for staff metrics</div>
            </div>
          </div>
        </div>
      `;
    }

    // Analytics detail functions
    window.showSalesAnalytics = function() {
      alert(`üìà SALES ANALYTICS\n\nToday: $2,847 (+15.3%)\nYesterday: $2,468\nThis Week: $18,420\nLast Week: $16,890 (+9.1%)\n\nBest Hour: 12:00-1:00 PM ($387)\nWorst Hour: 3:00-4:00 PM ($89)\n\nTrend: ‚¨ÜÔ∏è Increasing`);
    };

    window.showPopularMeals = function() {
      alert(`üçΩÔ∏è POPULAR MEALS RANKING\n\n1. Grilled Chicken Bowl (23 orders)\n2. Veggie Wrap (18 orders)\n3. Caesar Salad (15 orders)\n4. Protein Smoothie (12 orders)\n5. Keto Bowl (8 orders)\n6. Fresh Juice (5 orders)\n\nTop Revenue: Chicken Bowl ($345)\nFastest Seller: Veggie Wrap (avg 12 min)`);
    };

    window.showPrepTimeAnalytics = function() {
      alert(`‚è±Ô∏è PREP TIME ANALYSIS\n\nOverall Average: 18 minutes\nYesterday: 20 minutes (-2 min)\n\nBy Category:\n‚Ä¢ Bowls: 22 minutes\n‚Ä¢ Wraps: 15 minutes\n‚Ä¢ Salads: 12 minutes\n‚Ä¢ Smoothies: 8 minutes\n\nFastest: Fresh Juice (3 min)\nSlowest: Keto Bowl (28 min)`);
    };

    window.showRevenueBreakdown = function() {
      alert(`üí∞ REVENUE BREAKDOWN\n\nTotal: $2,847\n\nBy Category:\n‚Ä¢ Protein Dishes: $1,420 (50%)\n‚Ä¢ Vegetarian: $711 (25%)\n‚Ä¢ Beverages: $427 (15%)\n‚Ä¢ Salads: $289 (10%)\n\nPayment Methods:\n‚Ä¢ Credit Card: $2,135 (75%)\n‚Ä¢ Cash: $569 (20%)\n‚Ä¢ Mobile Pay: $143 (5%)`);
    };

    window.showCustomerAnalytics = function() {
      alert(`üë• CUSTOMER ANALYTICS\n\nToday: 89 unique customers\nAverage Order: $31.98\nNew Customers: 12 (13%)\nReturning: 77 (87%)\n\nBusiest Period: 12:00-2:00 PM\nCustomer Satisfaction: 4.7/5\nAverage Wait Time: 15 minutes\n\nTop Customer: John D. (3 orders, $89)`);
    };

    window.showStaffEfficiency = function() {
      alert(`‚≠ê STAFF EFFICIENCY\n\nOverall Performance: 94%\n\nBy Staff Member:\n‚Ä¢ John Smith (Head Chef): 98%\n‚Ä¢ Maria Garcia (Sous Chef): 95%\n‚Ä¢ David Lee (Line Cook): 92%\n‚Ä¢ Sarah Johnson (Prep Cook): 90%\n\nMetrics:\n‚Ä¢ Order Accuracy: 97%\n‚Ä¢ Speed Score: 91%\n‚Ä¢ Customer Rating: 4.8/5`);
    };

    function loadInventory() {
      const inventoryList = document.getElementById('inventory-list');
      
      const sampleInventory = [
        { item: 'Chicken Breast', quantity: 45, unit: 'lbs', status: 'good', reorderLevel: 20 },
        { item: 'Rice', quantity: 12, unit: 'lbs', status: 'low', reorderLevel: 15 },
        { item: 'Lettuce', quantity: 8, unit: 'heads', status: 'critical', reorderLevel: 10 },
        { item: 'Tomatoes', quantity: 25, unit: 'lbs', status: 'good', reorderLevel: 15 },
        { item: 'Olive Oil', quantity: 3, unit: 'bottles', status: 'low', reorderLevel: 5 },
        { item: 'Cheese', quantity: 18, unit: 'lbs', status: 'good', reorderLevel: 10 }
      ];

      inventoryList.innerHTML = `
        <div class="orders-grid">
          ${sampleInventory.map(item => `
            <div class="order-card" onclick="manageInventoryItem('${item.item}')" style="cursor: pointer;">
              <div class="order-header">
                <span class="order-id">${item.item}</span>
                <span class="order-status status-${item.status === 'good' ? 'ready' : item.status === 'low' ? 'preparing' : 'pending'}">
                  ${item.status.toUpperCase()}
                </span>
              </div>
              <div class="order-details">
                <strong>Current Stock:</strong> ${item.quantity} ${item.unit}<br>
                <strong>Reorder Level:</strong> ${item.reorderLevel} ${item.unit}<br>
                <small>Status: ${item.quantity <= item.reorderLevel ? '‚ö†Ô∏è Needs reordering' : '‚úÖ Adequate stock'}</small>
              </div>
              <div class="order-actions">
                <button class="button small" onclick="event.stopPropagation(); updateStock('${item.item}')">Update Stock</button>
                <button class="button small" onclick="event.stopPropagation(); reorderItem('${item.item}')">Reorder</button>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    window.manageInventoryItem = function(itemName) {
      if (kitchenData.guestAccess) {
        showError('Guest access: Inventory management not available');
        return;
      }
      
      const action = prompt(`Manage "${itemName}":\n1. View details\n2. Update quantity\n3. Set reorder level\n4. Order history\n\nEnter number (1-4):`);
      
      if (action === '1') {
        alert(`üì¶ INVENTORY DETAILS\n\nItem: ${itemName}\nSupplier: Fresh Foods Inc.\nLast Updated: Today\nCost per unit: $${(Math.random() * 5 + 2).toFixed(2)}\nShelf Life: ${Math.floor(Math.random() * 10) + 5} days`);
      } else if (action === '2') {
        const newQty = prompt('Enter new quantity:');
        if (newQty) {
          showSuccess(`${itemName} quantity updated to ${newQty}`);
          setTimeout(() => loadInventory(), 500);
        }
      } else if (action === '3') {
        const reorderLevel = prompt('Enter reorder level:');
        if (reorderLevel) showSuccess(`Reorder level set to ${reorderLevel}`);
      } else if (action === '4') {
        alert(`üìã ORDER HISTORY for ${itemName}\n\nLast Order: 3 days ago\nQuantity: 50 units\nSupplier: Fresh Foods Inc.\nCost: $${(Math.random() * 100 + 50).toFixed(2)}`);
      }
    };

    window.updateStock = function(itemName) {
      const quantity = prompt(`Update stock for ${itemName}:`);
      if (quantity) {
        showSuccess(`‚úÖ ${itemName} stock updated to ${quantity}`);
        setTimeout(() => loadInventory(), 500);
      }
    };

    window.reorderItem = function(itemName) {
      if (kitchenData.guestAccess) {
        showError('Guest access: Reordering not available');
        return;
      }
      
      const quantity = prompt(`Reorder quantity for ${itemName}:`);
      if (quantity) {
        showSuccess(`üõí Order placed: ${quantity} units of ${itemName}`);
      }
    };

    function loadStaff() {
      const staffList = document.getElementById('staff-list');
      
      const sampleStaff = [
        { name: 'John Smith', role: 'Head Chef', status: 'online', shift: '8:00 AM - 6:00 PM', performance: 4.8 },
        { name: 'Maria Garcia', role: 'Sous Chef', status: 'online', shift: '10:00 AM - 8:00 PM', performance: 4.6 },
        { name: 'David Lee', role: 'Line Cook', status: 'online', shift: '12:00 PM - 10:00 PM', performance: 4.3 },
        { name: 'Sarah Johnson', role: 'Prep Cook', status: 'break', shift: '6:00 AM - 4:00 PM', performance: 4.5 },
        { name: 'Mike Wilson', role: 'Kitchen Manager', status: 'offline', shift: '9:00 AM - 7:00 PM', performance: 4.9 },
        { name: 'Lisa Brown', role: 'Server', status: 'online', shift: '11:00 AM - 9:00 PM', performance: 4.4 }
      ];

      staffList.innerHTML = `
        <div class="orders-grid">
          ${sampleStaff.map(staff => `
            <div class="order-card" onclick="manageStaff('${staff.name}')" style="cursor: pointer;">
              <div class="order-header">
                <span class="order-id">${staff.name}</span>
                <span class="order-status status-${staff.status === 'online' ? 'ready' : staff.status === 'break' ? 'preparing' : 'pending'}">
                  ${staff.status.toUpperCase()}
                </span>
              </div>
              <div class="order-details">
                <strong>Role:</strong> ${staff.role}<br>
                <strong>Shift:</strong> ${staff.shift}<br>
                <strong>Performance:</strong> ‚≠ê ${staff.performance}/5.0<br>
                <small>${staff.status === 'online' ? 'üü¢ Active now' : staff.status === 'break' ? 'ÔøΩ On break' : 'üî¥ Off duty'}</small>
              </div>
              <div class="order-actions">
                <button class="button small" onclick="event.stopPropagation(); messageStaff('${staff.name}')">Message</button>
                <button class="button small" onclick="event.stopPropagation(); viewSchedule('${staff.name}')">Schedule</button>
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    window.manageStaff = function(staffName) {
      if (kitchenData.guestAccess) {
        showError('Guest access: Staff management not available');
        return;
      }
      
      const action = prompt(`Manage "${staffName}":\n1. View profile\n2. Edit schedule\n3. Performance review\n4. Send notification\n5. Time tracking\n\nEnter number (1-5):`);
      
      if (action === '1') {
        alert(`üë§ STAFF PROFILE\n\nName: ${staffName}\nEmployee ID: EMP${Math.floor(Math.random() * 1000) + 100}\nHire Date: ${new Date(Date.now() - Math.random() * 365 * 24 * 60 * 60 * 1000).toLocaleDateString()}\nPhone: (555) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}\nEmergency Contact: Available in HR system`);
      } else if (action === '2') {
        showSuccess(`üìÖ Opening schedule editor for ${staffName}...`);
      } else if (action === '3') {
        alert(`‚≠ê PERFORMANCE REVIEW\n\nEmployee: ${staffName}\nOverall Rating: ${(Math.random() * 2 + 3).toFixed(1)}/5.0\nPunctuality: Excellent\nTeamwork: Good\nSkill Level: Proficient\nNext Review: ${new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toLocaleDateString()}`);
      } else if (action === '4') {
        const message = prompt(`Send notification to ${staffName}:`);
        if (message) showSuccess(`üì± Notification sent to ${staffName}: "${message}"`);
      } else if (action === '5') {
        alert(`‚è∞ TIME TRACKING for ${staffName}\n\nClock In: 8:15 AM\nBreaks: 30 min\nCurrent Hours: ${Math.floor(Math.random() * 8) + 1}h ${Math.floor(Math.random() * 60)}m\nWeekly Total: ${Math.floor(Math.random() * 20) + 25} hours`);
      }
    };

    window.messageStaff = function(staffName) {
      const message = prompt(`Send message to ${staffName}:`);
      if (message) {
        showSuccess(`üí¨ Message sent to ${staffName}: "${message}"`);
      }
    };

    window.viewSchedule = function(staffName) {
      alert(`üìÖ SCHEDULE for ${staffName}\n\nThis Week:\nMon: 8:00 AM - 6:00 PM\nTue: 10:00 AM - 8:00 PM\nWed: OFF\nThu: 8:00 AM - 6:00 PM\nFri: 12:00 PM - 10:00 PM\nSat: 9:00 AM - 7:00 PM\nSun: OFF\n\nTotal: 40 hours`);
    };

    // Update stats with more realistic data
    function updateStats() {
      document.getElementById('active-orders').textContent = Math.floor(Math.random() * 20) + 8;
      document.getElementById('preparing-orders').textContent = Math.floor(Math.random() * 10) + 3;
      document.getElementById('completed-today').textContent = Math.floor(Math.random() * 50) + 25;
      document.getElementById('today-revenue').textContent = (Math.floor(Math.random() * 1000) + 500).toLocaleString();
      document.getElementById('available-meals').textContent = Math.floor(Math.random() * 25) + 15;
      document.getElementById('low-stock-items').textContent = Math.floor(Math.random() * 8) + 1;
      document.getElementById('staff-online').textContent = Math.floor(Math.random() * 6) + 3;
    }

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCFeughLAfJ3THhLWVnxLqvvf2mjomkGxg",
      authDomain: "freshpunk-48db1.firebaseapp.com",
      projectId: "freshpunk-48db1",
      storageBucket: "freshpunk-48db1.firebasestorage.app",
      messagingSenderId: "433852717304",
      appId: "1:433852717304:web:318fdb802f7ff7f7c0c30d",
      measurementId: "G-11FZ3EQS7Y"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const functions = firebase.functions();
    const db = firebase.firestore();

    // Initialize
    updateStats();

    // Listen for authentication state changes
    auth.onAuthStateChanged(async (user) => {
      console.log('Auth state changed. User:', user ? user.email : 'null', 'Method:', currentAuthMethod);
      
      if (user && currentAuthMethod === 'firebase') {
        try {
          const idTokenResult = await user.getIdTokenResult();
          const isKitchen = idTokenResult.claims.kitchen || false;
          console.log('User claims - kitchen:', isKitchen);

          if (isKitchen) {
            currentUser = user;
            kitchenData = {
              name: idTokenResult.claims.kitchenName || 'Firebase Kitchen Pro',
              email: user.email,
              method: 'firebase',
              uid: user.uid,
              accessLevel: 'full'
            };
            sessionStorage.setItem('kitchen_data_pro', JSON.stringify(kitchenData));
            console.log('Firebase auth successful, showing dashboard');
            showKitchenDashboard();
          } else {
            await auth.signOut();
            showError('Access denied. Kitchen partner role required.');
            showScreen('auth-screen');
          }
        } catch (error) {
          console.error('Token verification error:', error);
          showScreen('auth-screen');
        }
      } else if (!user && currentAuthMethod === 'firebase') {
        console.log('No user and firebase method, showing auth');
        showScreen('auth-screen');
        showAuthMethodSelection();
      }
    });

    // Check if already authenticated on page load
    const existingAccess = sessionStorage.getItem('kitchen_access_pro');
    const existingData = sessionStorage.getItem('kitchen_data_pro');
    
    console.log('Page load check - existingAccess:', existingAccess, 'existingData:', existingData);
    
    if ((existingAccess === 'true' || existingAccess === 'guest') && existingData) {
      kitchenData = JSON.parse(existingData);
      console.log('Restored kitchenData:', kitchenData);
      
      if (kitchenData.method === 'firebase') {
        currentAuthMethod = 'firebase';
        console.log('Firebase method detected, waiting for auth state change');
        // Firebase auth will handle this via onAuthStateChanged
      } else {
        console.log('Non-firebase method, showing dashboard directly');
        showKitchenDashboard();
      }
    } else {
      console.log('No existing authentication, showing auth screen');
      showScreen('auth-screen');
      showAuthMethodSelection();
    }

    // Search functionality
    document.getElementById('order-search').addEventListener('input', function(e) {
      const searchTerm = e.target.value.toLowerCase();
      const orderCards = document.querySelectorAll('#orders-list .order-card');
      
      orderCards.forEach(card => {
        const orderText = card.textContent.toLowerCase();
        if (orderText.includes(searchTerm)) {
          card.style.display = 'block';
        } else {
          card.style.display = 'none';
        }
      });
      
      if (searchTerm) {
        showSuccess(`Searching orders for: "${searchTerm}"`);
      }
    });

    // Add search functionality for other sections
    document.addEventListener('DOMContentLoaded', function() {
      // Meal search
      const mealSearch = document.getElementById('meal-search');
      if (mealSearch) {
        mealSearch.addEventListener('input', function(e) {
          const searchTerm = e.target.value.toLowerCase();
          console.log('Searching meals for:', searchTerm);
          if (searchTerm) showSuccess(`Searching meals for: "${searchTerm}"`);
        });
      }

      // Inventory search
      const inventorySearch = document.getElementById('inventory-search');
      if (inventorySearch) {
        inventorySearch.addEventListener('input', function(e) {
          const searchTerm = e.target.value.toLowerCase();
          const inventoryCards = document.querySelectorAll('#inventory-list .order-card');
          
          inventoryCards.forEach(card => {
            const itemText = card.textContent.toLowerCase();
            if (itemText.includes(searchTerm)) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          });
          
          if (searchTerm) showSuccess(`Searching inventory for: "${searchTerm}"`);
        });
      }

      // Staff search
      const staffSearch = document.getElementById('staff-search');
      if (staffSearch) {
        staffSearch.addEventListener('input', function(e) {
          const searchTerm = e.target.value.toLowerCase();
          const staffCards = document.querySelectorAll('#staff-list .order-card');
          
          staffCards.forEach(card => {
            const staffText = card.textContent.toLowerCase();
            if (staffText.includes(searchTerm)) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          });
          
          if (searchTerm) showSuccess(`Searching staff for: "${searchTerm}"`);
        });
      }
    });
  </script>
</body>
</html>
