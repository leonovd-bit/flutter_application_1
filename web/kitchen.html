<!DOCTYPE html>
<html>
<head>
  <base href="$FLUTTER_BASE_HREF">
  <meta charset="UTF-8">
  <meta content="IE=Edge" http-equiv="X-UA-Compatible">
  <meta name="description" content="FreshPunk Kitchen Dashboard - Manage your orders and restaurant operations.">
  
  <!-- iOS meta tags & icons -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="FreshPunk Kitchen">
  <link rel="apple-touch-icon" href="icons/Icon-192.png">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="favicon.png"/>

  <title>FreshPunk Kitchen Dashboard</title>
  <link rel="manifest" href="manifest.json">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary-green: #4CAF50;
      --primary-dark: #388E3C;
      --primary-light: #81C784;
      --background: #FFFFFF;
      --surface: #FFFFFF;
      --surface-elevated: #F8F9FA;
      --text-primary: #212121;
      --text-secondary: #757575;
      --text-light: #BDBDBD;
      --border: #E0E0E0;
      --accent: #4CAF50;
      --success: #4CAF50;
      --warning: #FF9800;
      --error: #F44336;
    }

    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, var(--background) 0%, rgba(248, 249, 250, 0.95) 100%);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: var(--text-primary);
    }

    .container {
      text-align: center;
      padding: 48px;
      background: var(--surface);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1), 0 2px 8px rgba(0,0,0,0.05);
      max-width: 480px;
      width: 90%;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .logo {
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
      border-radius: 24px;
      margin: 0 auto 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 48px;
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.3);
    }

    h1 {
      margin: 0 0 12px 0;
      color: var(--text-primary);
      font-size: 32px;
      font-weight: 800;
      font-family: 'Poppins', sans-serif;
      letter-spacing: -0.5px;
    }

    .subtitle {
      color: var(--text-secondary);
      margin: 0 0 32px 0;
      font-size: 16px;
      font-weight: 500;
      line-height: 1.5;
    }

    #auth-container {
      display: block;
    }

    #loading-container {
      display: none;
    }

    #dashboard-container {
      display: none;
      min-height: 100vh;
    }

    .dashboard-header {
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
      color: white;
      padding: 20px 0;
      box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }

    .header-title h1 {
      margin: 0;
      font-size: 28px;
      font-weight: 800;
      font-family: 'Poppins', sans-serif;
      letter-spacing: -0.5px;
    }

    .header-title p {
      margin: 4px 0 0 0;
      opacity: 0.9;
      font-size: 16px;
      font-weight: 500;
    }

    .header-actions {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--surface);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border: 1px solid rgba(224, 224, 224, 0.3);
    }

    .stat-value {
      font-size: 32px;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      background: var(--surface-elevated);
      padding: 8px;
      border-radius: 12px;
      overflow-x: auto;
    }

    .tab-button {
      background: transparent;
      color: var(--text-secondary);
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s ease;
    }

    .tab-button.active {
      background: var(--primary-green);
      color: white;
    }

    .tab-content {
      background: var(--surface);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border: 1px solid rgba(224, 224, 224, 0.3);
    }

    .tab-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 16px;
    }

    .tab-header h2 {
      margin: 0;
      color: var(--text-primary);
      font-size: 20px;
      font-weight: 700;
      font-family: 'Poppins', sans-serif;
    }

    .order-filters {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 8px 16px;
      border: 2px solid var(--border);
      background: var(--surface);
      color: var(--text-secondary);
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .filter-btn.active {
      background: var(--primary-green);
      color: white;
      border-color: var(--primary-green);
    }

    .order-card {
      border: 2px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      background: var(--surface);
      transition: all 0.2s ease;
      cursor: pointer;
    }

    .order-card.pending {
      border-color: var(--warning);
      background: #FFF8E1;
    }

    .order-card.preparing {
      border-color: #2196F3;
      background: #E3F2FD;
    }

    .order-card.ready {
      border-color: var(--success);
      background: #E8F5E8;
    }

    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .order-id {
      font-size: 18px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 4px;
      font-family: 'Poppins', sans-serif;
    }

    .customer-name {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .order-meta {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 4px;
    }

    .status-badge {
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: bold;
      color: white;
    }

    .status-badge.pending {
      background: var(--warning);
    }

    .status-badge.preparing {
      background: #2196F3;
    }

    .status-badge.ready {
      background: var(--success);
    }

    .order-total {
      font-size: 18px;
      font-weight: 800;
      color: var(--text-primary);
      margin-top: 8px;
    }

    .order-items {
      border-top: 1px solid rgba(224, 224, 224, 0.5);
      padding-top: 16px;
      margin-bottom: 12px;
    }

    .order-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* Meals Tab Styles */
    .meals-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }

    .meal-card {
      background: var(--surface);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border: 1px solid var(--border);
      transition: transform 0.2s ease;
    }

    .meal-card:hover {
      transform: translateY(-2px);
    }

    /* Analytics Tab Styles */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .analytics-card {
      background: var(--surface);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border: 1px solid var(--border);
    }

    .analytics-card h3 {
      margin: 0 0 8px 0;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
    }

    .analytics-value {
      font-size: 28px;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .analytics-change {
      font-size: 14px;
      font-weight: 600;
    }

    .analytics-change.positive {
      color: var(--success);
    }

    .analytics-change.negative {
      color: var(--error);
    }

    .chart-container {
      background: var(--surface);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border: 1px solid var(--border);
    }

    .chart-placeholder {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-secondary);
    }

    /* Kitchen Tab Styles */
    .kitchen-sections {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
    }

    .kitchen-section {
      background: var(--surface);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border: 1px solid var(--border);
    }

    .kitchen-section h3 {
      margin: 0 0 16px 0;
      color: var(--text-primary);
      font-size: 18px;
      font-weight: 700;
    }

    .equipment-item, .staff-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border);
    }

    .equipment-item:last-child, .staff-item:last-child {
      border-bottom: none;
    }

    .status-indicator {
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
      color: white;
    }

    .status-indicator.active {
      background: var(--success);
    }

    .status-indicator.break {
      background: var(--warning);
    }

    .alert-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 8px;
    }

    .alert-item.warning {
      background: #FFF8E1;
      border: 1px solid var(--warning);
    }

    .alert-item.critical {
      background: #FFEBEE;
      border: 1px solid var(--error);
    }

    .button.small {
      padding: 6px 12px;
      font-size: 12px;
      width: auto;
      margin: 0;
    }

    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        text-align: center;
      }

      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }

      .order-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .tab-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .kitchen-sections {
        grid-template-columns: 1fr;
      }
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--primary-green);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .form-group {
      margin-bottom: 20px;
      text-align: left;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-primary);
      font-weight: 600;
      font-size: 14px;
      font-family: 'Poppins', sans-serif;
    }

    input {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 16px;
      font-weight: 500;
      box-sizing: border-box;
      background: var(--surface);
      transition: all 0.2s ease;
      font-family: 'Inter', sans-serif;
    }

    input:focus {
      outline: none;
      border-color: var(--primary-green);
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    }

    .button {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, var(--primary-green), var(--primary-light));
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'Poppins', sans-serif;
      letter-spacing: 0.3px;
      box-shadow: 0 4px 16px rgba(76, 175, 80, 0.4);
      margin-bottom: 16px;
    }

    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
    }

    .button:active {
      transform: translateY(0);
    }

    .button.secondary {
      background: linear-gradient(135deg, #757575, #616161);
      color: white;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 600;
      width: auto;
      box-shadow: 0 2px 8px rgba(117, 117, 117, 0.3);
    }

    .error {
      background: #FFEBEE;
      border: 1px solid #FFCDD2;
      color: #C62828;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 14px;
      font-weight: 600;
      display: none;
    }

    .access-codes {
      background: var(--surface-elevated);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      margin-top: 24px;
      text-align: left;
    }

    .access-codes h3 {
      margin: 0 0 16px 0;
      color: var(--text-primary);
      font-size: 16px;
      font-weight: 700;
      font-family: 'Poppins', sans-serif;
    }

    .access-codes div {
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: 8px;
      font-family: 'Monaco', 'Menlo', monospace;
      padding: 8px 12px;
      background: var(--surface);
      border-radius: 6px;
      border: 1px solid var(--border);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Authentication Form -->
    <div id="auth-container">
      <div class="logo">
        <svg width="60" height="60" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="15" y="25" width="70" height="50" rx="8" fill="white" opacity="0.9"/>
          <rect x="20" y="30" width="25" height="40" rx="4" fill="currentColor" opacity="0.8"/>
          <circle cx="55" cy="40" rx="8" ry="12" fill="#FF6B35" opacity="0.9"/>
          <rect x="68" y="30" width="12" height="18" rx="2" fill="#4CAF50" opacity="0.8"/>
          <rect x="68" y="52" width="12" height="18" rx="2" fill="#4CAF50" opacity="0.8"/>
          <path d="M10 20 L25 15 L25 80 L10 75 Z" fill="white" opacity="0.9"/>
          <path d="M75 20 L90 15 L90 80 L75 75 Z" fill="white" opacity="0.9"/>
        </svg>
      </div>
      
      <h1>Kitchen Access</h1>
      <p class="subtitle">Secure authentication for kitchen partners</p>
      
      <div id="error-message" class="error"></div>
      
      <form id="auth-form">
        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" required autocomplete="email">
        </div>
        
        <div class="form-group">
          <label for="password">Password</label>
          <input type="password" id="password" required autocomplete="current-password">
        </div>
        
        <button type="submit" class="button">Sign In to Kitchen Dashboard</button>
      </form>
      
      <div class="access-codes">
        <h3>Demo Access Codes (Development Only):</h3>
        <div>KITCHEN001 - Main Kitchen</div>
        <div>KITCHEN002 - East Kitchen</div>
        <div>KITCHEN003 - West Kitchen</div>
      </div>
    </div>

    <!-- Loading State -->
    <div id="loading-container">
      <div class="loading">
        <div class="spinner"></div>
        <p>Authenticating...</p>
      </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard-container">
      <!-- Dashboard Header -->
      <div class="dashboard-header">
        <div class="header-content">
          <div class="header-title">
            <h1>🍽️ FreshPunk Kitchen</h1>
            <p id="kitchen-info">Loading kitchen information...</p>
          </div>
          <div class="header-actions">
            <button class="button secondary" onclick="showAddMealForm()">+ Add Meal</button>
            <button class="button secondary" onclick="refreshDashboard()">🔄 Refresh</button>
            <button class="button secondary" onclick="signOut()">Logout</button>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Quick Stats -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" style="color: var(--primary-green);" id="active-orders">12</div>
            <div class="stat-label">Active Orders</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" style="color: var(--warning);" id="preparing-orders">7</div>
            <div class="stat-label">Preparing</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" style="color: #2196F3;" id="completed-today">28</div>
            <div class="stat-label">Completed Today</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" style="color: #9C27B0;" id="available-meals">15</div>
            <div class="stat-label">Available Meals</div>
          </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
          <button class="tab-button active" onclick="showTab('orders')" id="tab-orders">📋 Orders</button>
          <button class="tab-button" onclick="showTab('meals')" id="tab-meals">🍽️ Meals</button>
          <button class="tab-button" onclick="showTab('analytics')" id="tab-analytics">📊 Analytics</button>
          <button class="tab-button" onclick="showTab('kitchen')" id="tab-kitchen">⚙️ Kitchen</button>
        </div>

        <!-- Tab Content -->
        <div id="tab-content">
          <!-- Orders Tab (Default) -->
          <div id="orders-content" class="tab-content">
            <div class="tab-header">
              <h2>Active Orders</h2>
              <div class="order-filters">
                <button class="filter-btn active" onclick="filterOrders('all')" id="filter-all">All</button>
                <button class="filter-btn" onclick="filterOrders('pending')" id="filter-pending">Pending</button>
                <button class="filter-btn" onclick="filterOrders('preparing')" id="filter-preparing">Preparing</button>
                <button class="filter-btn" onclick="filterOrders('ready')" id="filter-ready">Ready</button>
              </div>
            </div>
            
            <div id="orders-list">
              <!-- Orders will be loaded here -->
            </div>
          </div>

          <!-- Meals Tab -->
          <div id="meals-content" class="tab-content hidden">
            <div class="tab-header">
              <h2>Menu Management</h2>
              <button class="button" onclick="showAddMealForm()">+ Add New Meal</button>
            </div>
            
            <div class="meals-grid" id="meals-grid">
              <!-- Meals will be loaded here -->
            </div>
          </div>

          <!-- Analytics Tab -->
          <div id="analytics-content" class="tab-content hidden">
            <div class="tab-header">
              <h2>Kitchen Analytics</h2>
              <div class="analytics-controls">
                <select class="analytics-period">
                  <option value="today">Today</option>
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                </select>
              </div>
            </div>
            
            <div class="analytics-grid">
              <div class="analytics-card">
                <h3>Revenue</h3>
                <div class="analytics-value">$1,247.50</div>
                <div class="analytics-change positive">+12.5%</div>
              </div>
              <div class="analytics-card">
                <h3>Orders</h3>
                <div class="analytics-value">89</div>
                <div class="analytics-change positive">+8.2%</div>
              </div>
              <div class="analytics-card">
                <h3>Avg Order Time</h3>
                <div class="analytics-value">18m</div>
                <div class="analytics-change negative">-2.1%</div>
              </div>
              <div class="analytics-card">
                <h3>Customer Rating</h3>
                <div class="analytics-value">4.8⭐</div>
                <div class="analytics-change positive">+0.2</div>
              </div>
            </div>

            <div class="chart-container">
              <h3>Order Volume (Last 7 Days)</h3>
              <div class="chart-placeholder">
                <p>📈 Chart visualization coming soon!</p>
              </div>
            </div>
          </div>

          <!-- Kitchen Tab -->
          <div id="kitchen-content" class="tab-content hidden">
            <div class="tab-header">
              <h2>Kitchen Management</h2>
            </div>
            
            <div class="kitchen-sections">
              <div class="kitchen-section">
                <h3>🔧 Equipment Status</h3>
                <div class="equipment-list">
                  <div class="equipment-item">
                    <span>� Grill Station</span>
                    <span class="status-indicator active">Active</span>
                  </div>
                  <div class="equipment-item">
                    <span>❄️ Refrigeration</span>
                    <span class="status-indicator active">Normal</span>
                  </div>
                  <div class="equipment-item">
                    <span>🥗 Prep Station</span>
                    <span class="status-indicator active">Available</span>
                  </div>
                </div>
              </div>

              <div class="kitchen-section">
                <h3>👥 Staff Management</h3>
                <div class="staff-list">
                  <div class="staff-item">
                    <span>👨‍🍳 Head Chef</span>
                    <span class="status-indicator active">On Duty</span>
                  </div>
                  <div class="staff-item">
                    <span>👩‍🍳 Prep Cook</span>
                    <span class="status-indicator active">On Duty</span>
                  </div>
                  <div class="staff-item">
                    <span>🧑‍🍳 Line Cook</span>
                    <span class="status-indicator break">Break</span>
                  </div>
                </div>
              </div>

              <div class="kitchen-section">
                <h3>📋 Inventory Alerts</h3>
                <div class="inventory-alerts">
                  <div class="alert-item warning">
                    <span>🥬 Lettuce - Low Stock</span>
                    <button class="button small">Reorder</button>
                  </div>
                  <div class="alert-item critical">
                    <span>🍗 Chicken - Critical</span>
                    <button class="button small">Urgent Order</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut as firebaseSignOut } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js';
    import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js';

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCFeughLAfJ3THhLWVnxLqvvf2mjomkGxg",
      authDomain: "freshpunk-48db1.firebaseapp.com",
      projectId: "freshpunk-48db1",
      storageBucket: "freshpunk-48db1.firebasestorage.app",
      messagingSenderId: "433852717304",
      appId: "1:433852717304:web:318fdb802f7ff7f7c0c30d",
      measurementId: "G-11FZ3EQS7Y"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const functions = getFunctions(app, 'us-east4');

    // DOM elements
    const authContainer = document.getElementById('auth-container');
    const loadingContainer = document.getElementById('loading-container');
    const dashboardContainer = document.getElementById('dashboard-container');
    const errorMessage = document.getElementById('error-message');
    const authForm = document.getElementById('auth-form');

    // Show error message
    function showError(message) {
      errorMessage.textContent = message;
      errorMessage.style.display = 'block';
    }

    // Hide error message
    function hideError() {
      errorMessage.style.display = 'none';
    }

    // Show loading state
    function showLoading() {
      authContainer.style.display = 'none';
      loadingContainer.style.display = 'block';
      dashboardContainer.style.display = 'none';
    }

    // Show authentication form
    function showAuth() {
      authContainer.style.display = 'block';
      loadingContainer.style.display = 'none';
      dashboardContainer.style.display = 'none';
    }

    // Show dashboard
    function showDashboard() {
      authContainer.style.display = 'none';
      loadingContainer.style.display = 'none';
      dashboardContainer.style.display = 'block';
      loadOrders();
      loadMeals();
      updateStats();
    }

    // Dashboard tab functions
    window.showTab = function(tabName) {
      // Update tab buttons
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.getElementById('tab-' + tabName).classList.add('active');

      // Show content
      document.querySelectorAll('[id$="-content"]').forEach(content => content.classList.add('hidden'));
      document.getElementById(tabName + '-content').classList.remove('hidden');

      // Load data for specific tabs
      if (tabName === 'orders') {
        loadOrders();
      } else if (tabName === 'meals') {
        loadMeals();
      }
    };

    // Dashboard functions
    window.refreshDashboard = function() {
      loadOrders();
      loadMeals();
      updateStats();
    };

    window.filterOrders = function(status) {
      document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      loadOrders(status);
    };

    window.updateOrderStatus = function(orderId, newStatus) {
      console.log(`Updating order ${orderId} to ${newStatus}`);
      // This would typically call a Cloud Function
      setTimeout(() => {
        loadOrders();
        updateStats();
      }, 500);
    };

    window.viewOrderDetails = function(orderId) {
      alert(`View details for order: ${orderId}`);
    };

    window.showAddMealForm = function() {
      alert('Add meal form coming soon!');
    };

    window.editMeal = function(mealId) {
      alert(`Edit meal ${mealId} - Coming soon!`);
    };

    window.toggleMealAvailability = function(mealId) {
      alert(`Toggle availability for meal ${mealId} - Coming soon!`);
    };

    // Load sample orders
    function loadOrders(filter = 'all') {
      const orders = [
        {
          id: 'ORD001',
          customer: 'John Smith',
          phone: '+1 (555) 123-4567',
          items: [
            { name: 'Grilled Chicken Salad', quantity: 2, price: 14.99 },
            { name: 'Fresh Fruit Bowl', quantity: 1, price: 8.99 }
          ],
          total: 38.97,
          status: 'pending',
          orderTime: '2:45 PM',
          estimatedReady: '3:15 PM',
          address: '123 Main St, Downtown',
          deliveryMethod: 'Pickup',
          notes: 'Extra dressing on the side'
        },
        {
          id: 'ORD002',
          customer: 'Sarah Johnson',
          phone: '+1 (555) 987-6543',
          items: [
            { name: 'Quinoa Power Bowl', quantity: 1, price: 16.99 },
            { name: 'Green Smoothie', quantity: 2, price: 6.99 }
          ],
          total: 30.97,
          status: 'preparing',
          orderTime: '2:30 PM',
          estimatedReady: '3:00 PM',
          address: '456 Oak Ave, Midtown',
          deliveryMethod: 'Delivery',
          notes: 'No onions please'
        },
        {
          id: 'ORD003',
          customer: 'Mike Wilson',
          phone: '+1 (555) 456-7890',
          items: [
            { name: 'Mediterranean Wrap', quantity: 3, price: 12.99 }
          ],
          total: 38.97,
          status: 'ready',
          orderTime: '2:15 PM',
          estimatedReady: '2:45 PM',
          address: '789 Pine St, Uptown',
          deliveryMethod: 'Pickup',
          notes: 'Call when ready'
        }
      ];

      const filteredOrders = filter === 'all' ? orders : orders.filter(order => order.status === filter);
      const ordersContainer = document.getElementById('orders-list');
      
      if (filteredOrders.length === 0) {
        ordersContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">No orders found for this filter.</p>';
        return;
      }

      ordersContainer.innerHTML = filteredOrders.map(order => createOrderCard(order)).join('');
    }

    function createOrderCard(order) {
      return `
        <div class="order-card ${order.status}" onclick="viewOrderDetails('${order.id}')">
          <div class="order-header">
            <div>
              <div class="order-id">${order.id}</div>
              <div class="customer-name">${order.customer}</div>
              <div class="order-meta">📱 ${order.phone}</div>
              <div class="order-meta">🕐 Ordered: ${order.orderTime} | Ready: ${order.estimatedReady}</div>
              <div class="order-meta">${order.deliveryMethod === 'Pickup' ? '🏪' : '🚚'} ${order.deliveryMethod}</div>
            </div>
            <div style="text-align: right;">
              <div class="status-badge ${order.status}">${order.status.toUpperCase()}</div>
              <div class="order-total">$${order.total.toFixed(2)}</div>
            </div>
          </div>
          
          <div class="order-items">
            <strong>Items:</strong><br>
            ${order.items.map(item => `• ${item.quantity}x ${item.name} - $${item.price}`).join('<br>')}
            ${order.notes ? `<br><br><strong>Notes:</strong> ${order.notes}` : ''}
          </div>
          
          <div class="order-actions">
            ${order.status === 'pending' ? `<button class="button small" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'preparing')" style="background: var(--warning);">Start Preparing</button>` : ''}
            ${order.status === 'preparing' ? `<button class="button small" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'ready')" style="background: var(--success);">Mark Ready</button>` : ''}
            ${order.status === 'ready' ? `<button class="button small" onclick="event.stopPropagation(); updateOrderStatus('${order.id}', 'completed')" style="background: #2196F3;">Mark Completed</button>` : ''}
            <button class="button small secondary" onclick="event.stopPropagation(); viewOrderDetails('${order.id}')">View Details</button>
          </div>
        </div>
      `;
    }

    // Load sample meals
    function loadMeals() {
      const meals = [
        {
          id: 'MEAL001',
          name: 'Grilled Chicken Salad',
          description: 'Fresh mixed greens with grilled chicken breast, cherry tomatoes, and house dressing',
          price: 14.99,
          category: 'Salads',
          available: true,
          prepTime: '8-12 min'
        },
        {
          id: 'MEAL002',
          name: 'Quinoa Power Bowl',
          description: 'Nutrient-rich quinoa with roasted vegetables, avocado, and tahini dressing',
          price: 16.99,
          category: 'Bowls',
          available: true,
          prepTime: '10-15 min'
        },
        {
          id: 'MEAL003',
          name: 'Mediterranean Wrap',
          description: 'Whole wheat wrap with hummus, grilled vegetables, and feta cheese',
          price: 12.99,
          category: 'Wraps',
          available: false,
          prepTime: '5-8 min'
        }
      ];

      const mealsContainer = document.getElementById('meals-grid');
      mealsContainer.innerHTML = meals.map(meal => `
        <div class="meal-card">
          <div style="display: flex; justify-content: between; align-items: flex-start; margin-bottom: 12px;">
            <div style="flex: 1;">
              <h3 style="margin: 0 0 8px 0; color: var(--text-primary); font-size: 18px; font-weight: 700;">${meal.name}</h3>
              <p style="margin: 0 0 8px 0; color: var(--text-secondary); font-size: 14px; line-height: 1.4;">${meal.description}</p>
              <div style="margin-bottom: 12px;">
                <span style="background: var(--surface-elevated); padding: 4px 8px; border-radius: 12px; font-size: 12px; color: var(--text-secondary); margin-right: 8px;">⏱️ ${meal.prepTime}</span>
                <span style="background: var(--surface-elevated); padding: 4px 8px; border-radius: 12px; font-size: 12px; color: var(--text-secondary);">${meal.category}</span>
              </div>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 20px; font-weight: 800; color: var(--text-primary); margin-bottom: 8px;">$${meal.price}</div>
              <div style="font-size: 12px; font-weight: 600; color: ${meal.available ? 'var(--success)' : 'var(--error)'}">${meal.available ? 'Available' : 'Unavailable'}</div>
            </div>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="button small" onclick="editMeal('${meal.id}')">Edit</button>
            <button class="button small ${meal.available ? 'secondary' : ''}" onclick="toggleMealAvailability('${meal.id}')">${meal.available ? 'Disable' : 'Enable'}</button>
          </div>
        </div>
      `).join('');
    }

    // Update dashboard stats
    function updateStats() {
      // These would typically come from your backend
      document.getElementById('active-orders').textContent = '12';
      document.getElementById('preparing-orders').textContent = '7';
      document.getElementById('completed-today').textContent = '28';
      document.getElementById('available-meals').textContent = '15';
    }

    // Handle form submission
    authForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      hideError();
      showLoading();

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      try {
        // Sign in with Firebase Auth
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // Get the user's ID token
        const idToken = await user.getIdToken();

        // Check if user has kitchen role
        const idTokenResult = await user.getIdTokenResult();
        const isKitchen = idTokenResult.claims.kitchen || false;

        if (!isKitchen) {
          throw new Error('Access denied. Kitchen partner role required.');
        }

        console.log('Kitchen authentication successful');
        
        // Update kitchen info in dashboard
        const kitchenInfo = document.getElementById('kitchen-info');
        const kitchenName = idTokenResult.claims.kitchenName || 'FreshPunk Kitchen';
        const kitchenId = idTokenResult.claims.kitchenId || 'main';
        
        kitchenInfo.innerHTML = `
          <strong>${kitchenName}</strong> • Kitchen ID: ${kitchenId}<br>
          <small>Authenticated as: ${user.email}</small>
        `;
        
        showDashboard();

      } catch (error) {
        console.error('Authentication error:', error);
        showError(error.message || 'Authentication failed. Please check your credentials.');
        showAuth();
      }
    });

    // Handle sign out
    window.signOut = async () => {
      try {
        await firebaseSignOut(auth);
        showAuth();
      } catch (error) {
        console.error('Sign out error:', error);
        showError('Failed to sign out. Please try again.');
      }
    };

    // Listen for authentication state changes
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        try {
          // Check if user has kitchen role
          const idTokenResult = await user.getIdTokenResult();
          const isKitchen = idTokenResult.claims.kitchen || false;

          if (isKitchen) {
            showDashboard();
          } else {
            await firebaseSignOut(auth);
            showError('Access denied. Kitchen partner role required.');
            showAuth();
          }
        } catch (error) {
          console.error('Token verification error:', error);
          showAuth();
        }
      } else {
        showAuth();
      }
    });
  </script>
</body>
</html>
